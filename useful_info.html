<script>
        document.addEventListener('DOMContentLoaded', function() {
            const localPcPlanDiv = document.getElementById('local-pc-plan');

            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition, showError);
                } else {
                    localPcPlanDiv.innerHTML = '<p>La geolocalizzazione non è supportata dal tuo browser.</p>';
                }
            }

            function showPosition(position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                // Qui dovremmo fare una chiamata a un servizio (API) di geocoding inverso
                // per ottenere il comune più vicino a queste coordinate.
                // Per ora, simuleremo un risultato:
                const nearestCity = 'Potenza';
                suggestLocalPlan(nearestCity);
            }

            function showError(error) {
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        localPcPlanDiv.innerHTML = '<p>Permesso di geolocalizzazione negato dall\'utente.</p>';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        localPcPlanDiv.innerHTML = '<p>Informazioni sulla posizione non disponibili.</p>';
                        break;
                    case error.TIMEOUT:
                        localPcPlanDiv.innerHTML = '<p>Timeout nel tentativo di ottenere la posizione.</p>';
                        break;
                    case error.UNKNOWN_ERROR:
                        localPcPlanDiv.innerHTML = '<p>Errore sconosciuto durante la geolocalizzazione.</p>';
                        break;
                }
            }

            function suggestLocalPlan(city) {
                const pcPlans = {
                    'potenza': { text: 'Visualizza il Piano di Protezione Civile del Comune di Potenza.', link: '#piano_potenza_reale' },
                    'matera': { text: 'Visualizza il Piano di Protezione Civile del Comune di Matera.', link: '#piano_matera_reale' },
                    'lagonegro': { text: 'Visualizza il Piano di Protezione Civile del Comune di Lagonegro.', link: '#piano_lagonegro_reale' }
                    // Aggiungi altri comuni e link reali se li trovi
                };

                if (pcPlans[city.toLowerCase()]) {
                    localPcPlanDiv.innerHTML = `<h3>Piano di Protezione Civile Locale (Rilevato: ${city})</h3><p>${pcPlans[city.toLowerCase()].text}</p><p><a href="${pcPlans[city.toLowerCase()].link}" target="_blank"><i class="fas fa-external-link-alt"></i> Visualizza il Piano</a></p>`;
                } else {
                    localPcPlanDiv.innerHTML = '<h3>Piano di Protezione Civile Locale</h3><p>Impossibile determinare il piano specifico per la tua posizione attuale. Puoi consultare l\'elenco completo dei comuni.</p>';
                }
            }

            // Chiedi la posizione al caricamento della pagina
            getLocation();

            // Mostra comunque l'elenco dei piani (anche se non specifico)
            const pcPlansList = document.getElementById('pc-plans-list');
            const allPlans = {
                'potenza': '#piano_potenza_elenco',
                'matera': '#piano_matera_elenco',
                'melfi': '#piano_melfi_elenco'
                // Aggiungi tutti i comuni che vuoi elencare
            };
            let listItems = '';
            for (const city in allPlans) {
                listItems += `<li><a href="${allPlans[city]}">Piano di Emergenza Comune di ${city.charAt(0).toUpperCase() + city.slice(1)} <i class="fas fa-external-link-alt"></i></a></li>`;
            }
            pcPlansList.innerHTML = listItems;

        });
    </script>
